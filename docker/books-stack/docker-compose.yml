services:
  calibre-web:
    image: lscr.io/linuxserver/calibre-web:0.6.25
    container_name: calibre-web
    environment:
      - PUID=501
      - PGID=20
      - TZ=Europe/London
      - DOCKER_MODS=linuxserver/mods:universal-calibre
    volumes:
      - calibre-web-config:/config
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/eBooks:/books
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Downloads:/downloads
      - ./book-import.sh:/custom-services.d/book-import
    ports:
      - "8083:8083"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:8083/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:2.32.1
    container_name: audiobookshelf
    environment:
      - TZ=Europe/London
    volumes:
      - audiobookshelf-config:/config
      - audiobookshelf-metadata:/metadata
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/Audiobooks:/audiobooks
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/eBooks:/books
    ports:
      - "13378:80"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://127.0.0.1:80/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  readarr:
    # pennydreadful/bookshelf softcover â€” Readarr revival with rreading-glasses support
    # (upstream Readarr was archived June 2025, api.bookinfo.club is dead)
    image: ghcr.io/pennydreadful/bookshelf:softcover-v0.4.20
    container_name: readarr
    environment:
      - TZ=Europe/London
    volumes:
      - readarr-config:/config
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books:/books
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Downloads:/downloads
    ports:
      - "8787:8787"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:8787/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  homeserver:
    external: true

volumes:
  calibre-web-config:
    name: calibre-web-config
  audiobookshelf-config:
    name: audiobookshelf-config
  audiobookshelf-metadata:
    name: audiobookshelf-metadata
  readarr-config:
    name: readarr-config
