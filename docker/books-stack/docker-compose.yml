services:
  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:2.32.1
    container_name: audiobookshelf
    environment:
      - TZ=Europe/London
    volumes:
      - audiobookshelf-config:/config
      - audiobookshelf-metadata:/metadata
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/Audiobooks:/audiobooks
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/eBooks:/books
    ports:
      - "13378:80"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://127.0.0.1:80/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  lazylibrarian:
    image: lscr.io/linuxserver/lazylibrarian:latest
    container_name: lazylibrarian
    environment:
      - PUID=501
      - PGID=20
      - TZ=Europe/London
      - DOCKER_MODS=linuxserver/mods:universal-calibre|linuxserver/mods:lazylibrarian-ffmpeg
    volumes:
      - lazylibrarian-config:/config
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/Audiobooks:/audiobooks
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/eBooks:/books
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Downloads:/downloads
    ports:
      - "5299:5299"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:5299/home"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  homeserver:
    external: true

volumes:
  audiobookshelf-config:
    name: audiobookshelf-config
  audiobookshelf-metadata:
    name: audiobookshelf-metadata
  lazylibrarian-config:
    name: lazylibrarian-config
