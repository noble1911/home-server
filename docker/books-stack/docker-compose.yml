services:
  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:2.32.1
    container_name: audiobookshelf
    environment:
      - TZ=Europe/London
    volumes:
      - audiobookshelf-config:/config
      - audiobookshelf-metadata:/metadata
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/Audiobooks:/audiobooks
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/eBooks:/books
    ports:
      - "13378:80"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://127.0.0.1:80/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  shelfarr:
    image: ghcr.io/pedro-revez-silva/shelfarr:latest
    container_name: shelfarr
    environment:
      - SOLID_QUEUE_IN_PUMA=1
      - PUID=501
      - PGID=20
      - TZ=Europe/London
    volumes:
      - shelfarr-data:/rails/storage
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/Audiobooks:/audiobooks
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Books/eBooks:/ebooks
      - ${DRIVE_PATH:-/Volumes/HomeServer}/Downloads:/downloads
    ports:
      - "5056:80"
    networks:
      - homeserver
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/up"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  homeserver:
    external: true

volumes:
  audiobookshelf-config:
    name: audiobookshelf-config
  audiobookshelf-metadata:
    name: audiobookshelf-metadata
  shelfarr-data:
    name: shelfarr-data
