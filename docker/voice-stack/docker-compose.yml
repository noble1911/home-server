services:
  livekit:
    image: livekit/livekit-server:latest
    container_name: livekit
    command: --config /etc/livekit.yaml
    volumes:
      - ./livekit.yaml:/etc/livekit.yaml:ro
    ports:
      - "7880:7880"
      - "7881:7881"
      - "7882:7882/udp"
    networks:
      - homeserver
    restart: unless-stopped

  whisper:
    image: onerahmet/openai-whisper-asr-webservice:latest
    container_name: whisper
    environment:
      - ASR_MODEL=small
      - ASR_ENGINE=openai_whisper
    ports:
      - "9000:9000"
    networks:
      - homeserver
    restart: unless-stopped

  kokoro-tts:
    image: ghcr.io/remsky/kokoro-fastapi:latest
    container_name: kokoro-tts
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - kokoro-models:/app/models
    ports:
      - "8880:8880"
    networks:
      - homeserver
    restart: unless-stopped

  livekit-agent:
    build: ../../butler/livekit-agent
    container_name: livekit-agent
    environment:
      - LIVEKIT_URL=ws://livekit:7880
      - LIVEKIT_API_KEY=${LIVEKIT_API_KEY:-devkey}
      - LIVEKIT_API_SECRET=${LIVEKIT_API_SECRET:-secret}
      - GROQ_API_KEY=${GROQ_API_KEY}
      - KOKORO_URL=http://kokoro-tts:8880
      - BUTLER_API_URL=http://butler-api:8000
      - BUTLER_API_KEY=${INTERNAL_API_KEY:-}
    depends_on:
      - livekit
      - kokoro-tts
    networks:
      - homeserver
    restart: unless-stopped

networks:
  homeserver:
    external: true

volumes:
  kokoro-models:
